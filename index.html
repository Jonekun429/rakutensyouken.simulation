<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªç·åˆåˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-green: #10b981;
            --dark-green: #059669;
            --light-green: #d1fae5;
            --accent-green: #34d399;
            --bg-main: #f0fdf4;
            --bg-card: #ffffff;
            --text-primary: #064e3b;
            --text-secondary: #047857;
            --text-muted: #6b7280;
            --border-color: #a7f3d0;
            --shadow: 0 4px 20px rgba(16, 185, 129, 0.1);
            --shadow-hover: 0 8px 30px rgba(16, 185, 129, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        header {
            background: var(--bg-card);
            padding: 40px;
            border-radius: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 2px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--primary-green), var(--accent-green), var(--primary-green));
            background-size: 200% 100%;
            animation: shimmer 3s linear infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        h1 {
            font-size: 42px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary-green), var(--dark-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--text-muted);
            font-size: 16px;
            font-weight: 400;
        }

        .fear-greed-widget {
            background: white;
            padding: 16px 20px;
            border-radius: 16px;
            border: 2px solid var(--border-color);
            min-width: 0;
            flex: 0 0 auto;
            max-width: 580px;
            width: 100%;
        }

        .fgi-top-row {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .fgi-left {
            flex: 1;
            min-width: 0;
        }

        .fgi-right {
            flex: 0 0 160px;
        }

        .fear-greed-label {
            font-size: 15px;
            font-weight: 800;
            color: #1f2937;
            font-family: Arial, sans-serif;
            line-height: 1.2;
        }

        .fear-greed-subtitle {
            font-size: 11px;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .fgi-score-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fear-greed-number {
            font-size: 48px;
            font-weight: 900;
            font-family: Arial, sans-serif;
            line-height: 1;
        }

        .fgi-status-col {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .fear-greed-status {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .fgi-comparison {
            font-size: 11px;
            color: var(--text-muted);
        }

        .fear-greed-gauge-container {
            width: 160px;
        }

        .fear-greed-gauge-container svg {
            width: 100%;
            height: auto;
        }

        /* 7æŒ‡æ¨™ï¼š2åˆ—ã‚°ãƒªãƒƒãƒ‰ */
        .fgi-indicators {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px 16px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
        }

        .fgi-indicator-row {
            margin-bottom: 0;
        }

        .fgi-ind-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3px;
        }

        .fgi-ind-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .fgi-ind-score {
            font-size: 12px;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
        }

        .fgi-bar-bg {
            width: 100%;
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 1px;
        }

        .fgi-bar-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.8s ease;
        }

        .fgi-ind-desc {
            font-size: 9px;
            color: var(--text-muted);
        }

        .upload-section {
            margin-top: 25px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }

        input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-label {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            padding: 16px 32px;
            background: linear-gradient(135deg, var(--primary-green), var(--dark-green));
            color: white;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
            font-size: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .file-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }

        .file-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--light-green);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .info-card {
            background: white;
            padding: 20px;
            border-radius: 16px;
            border-left: 4px solid var(--primary-green);
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .info-card h3 {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-card ul {
            list-style: none;
            padding-left: 0;
        }

        .info-card li {
            padding: 8px 0;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-card li::before {
            content: 'âœ“';
            color: var(--primary-green);
            font-weight: bold;
            font-size: 18px;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--bg-card);
            padding: 28px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-green), var(--accent-green));
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .card-icon {
            font-size: 32px;
            margin-bottom: 12px;
            display: block;
        }

        .card-title {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1.2px;
            font-weight: 600;
        }

        .card-value {
            font-size: 36px;
            font-weight: 800;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            line-height: 1.2;
        }

        .card-value.positive {
            color: var(--primary-green);
        }

        .card-value.negative {
            color: #ef4444;
        }

        .card-value.score {
            font-size: 56px;
        }

        .score-grade {
            display: inline-block;
            margin-left: 12px;
            font-size: 32px;
            font-weight: 800;
        }

        .card-subtitle {
            font-size: 14px;
            color: var(--text-muted);
            margin-top: 8px;
        }

        /* å¸‚å ´åˆ†æã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .market-analysis {
            background: white;
            padding: 32px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 2px solid var(--border-color);
            margin-bottom: 30px;
        }

        .market-analysis h2 {
            color: var(--text-primary);
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .analysis-section {
            background: linear-gradient(135deg, var(--light-green), white);
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-green);
        }

        .analysis-section h3 {
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .analysis-text {
            color: var(--text-secondary);
            line-height: 1.8;
            font-size: 15px;
        }

        .analysis-highlight {
            background: #fef3c7;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 700;
            color: #92400e;
        }

        .strategy-list {
            list-style: none;
            padding-left: 0;
            margin-top: 12px;
        }

        .strategy-list li {
            padding: 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            border-left: 3px solid var(--primary-green);
        }

        .strategy-list li::before {
            content: 'â–¶';
            color: var(--primary-green);
            font-weight: bold;
            flex-shrink: 0;
        }

        /* æ¥­ç•Œã‚µãƒãƒªãƒ¼ */
        .industry-summary {
            background: white;
            padding: 32px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 2px solid var(--border-color);
            margin-bottom: 30px;
        }

        .industry-summary h2 {
            color: var(--text-primary);
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .industry-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
        }

        .industry-item {
            background: linear-gradient(135deg, var(--light-green), white);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .industry-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
            border-color: var(--primary-green);
        }

        .industry-item:active {
            transform: translateY(0);
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
        }

        .modal-header h2 {
            color: var(--text-primary);
            font-size: 28px;
            font-weight: 800;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 32px;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.2s;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: var(--light-green);
            color: var(--text-primary);
        }

        .stock-list-item {
            padding: 20px;
            border-radius: 12px;
            background: var(--light-green);
            margin-bottom: 15px;
            transition: all 0.2s;
        }

        .stock-list-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow);
        }

        .stock-list-code {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            color: var(--primary-green);
            font-size: 16px;
            margin-bottom: 5px;
        }

        .stock-list-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 18px;
            margin-bottom: 10px;
        }

        .stock-list-details {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .stock-list-detail {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .stock-list-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stock-list-value {
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .industry-item-name {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .industry-item-count {
            font-size: 28px;
            font-weight: 800;
            color: var(--primary-green);
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: 4px;
        }

        .industry-item-label {
            font-size: 12px;
            color: var(--text-muted);
        }

        .analysis-tabs {
            background: white;
            border-radius: 20px;
            padding: 8px;
            margin-bottom: 20px;
            display: flex;
            gap: 8px;
            box-shadow: var(--shadow);
            border: 2px solid var(--border-color);
            flex-wrap: wrap;
        }

        .tab-button {
            flex: 1;
            min-width: 120px;
            padding: 14px 24px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            font-weight: 600;
            font-size: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Outfit', sans-serif;
        }

        .tab-button.active {
            background: linear-gradient(135deg, var(--primary-green), var(--dark-green));
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .tab-button:hover:not(.active) {
            background: var(--light-green);
            color: var(--text-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .stock-table {
            background: var(--bg-card);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            border: 2px solid var(--border-color);
        }

        .table-header {
            padding: 28px;
            background: linear-gradient(135deg, var(--primary-green), var(--dark-green));
            color: white;
        }

        .table-header h2 {
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .table-header p {
            opacity: 0.9;
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--light-green);
        }

        th {
            padding: 18px 16px;
            text-align: left;
            font-weight: 700;
            color: var(--text-primary);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        td {
            padding: 20px 16px;
            border-bottom: 1px solid #f0fdf4;
            color: var(--text-primary);
            font-size: 15px;
        }

        tr:hover {
            background: var(--light-green);
        }

        .stock-code {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            color: var(--primary-green);
            font-size: 16px;
        }

        .stock-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .account-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        .account-tokutei { background: #dbeafe; color: #1e40af; }
        .account-nisa-tsumitate { background: #fef3c7; color: #92400e; }
        .account-nisa-growth { background: #fce7f3; color: #9f1239; }
        .account-ideco { background: #e0e7ff; color: #4338ca; }

        .industry-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        .industry-ä¸å‹•ç”£ { background: #fef3c7; color: #92400e; }
        .industry-å»ºè¨­ { background: #ddd6fe; color: #5b21b6; }
        .industry-é‡‘è { background: #dbeafe; color: #1e40af; }
        .industry-é£Ÿå“ { background: #fce7f3; color: #9f1239; }
        .industry-ã‚µãƒ¼ãƒ“ã‚¹ { background: #e0e7ff; color: #3730a3; }
        .industry-IT { background: #cffafe; color: #155e75; }
        .industry-è£½é€  { background: #fed7aa; color: #9a3412; }
        .industry-åŒ–å­¦ { background: #e0e7ff; color: #4338ca; }
        .industry-æ©Ÿæ¢° { background: #fecaca; color: #991b1b; }
        .industry-å°å£² { background: #fef9c3; color: #713f12; }
        .industry-å•†ç¤¾ { background: #d1fae5; color: #065f46; }
        .industry-åŒ»è–¬å“ { background: #fbcfe8; color: #831843; }
        .industry-ã‚¨ãƒ³ã‚¿ãƒ¡ { background: #fce7f3; color: #9f1239; }
        .industry-ã‚¤ãƒ³ãƒ•ãƒ© { background: #ccfbf1; color: #115e59; }

        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .badge.strong-buy {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        .badge.buy {
            background: #d1fae5;
            color: #065f46;
        }

        .badge.hold {
            background: #fef3c7;
            color: #92400e;
        }

        .positive-value {
            color: var(--primary-green);
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .negative-value {
            color: #ef4444;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .action-cell {
            font-weight: 700;
            color: var(--text-primary);
            min-width: 120px;
        }

        .action-cell.empty {
            color: var(--text-muted);
            font-style: italic;
            font-weight: 400;
        }

        .reason-cell {
            max-width: 300px;
            line-height: 1.5;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .reason-highlight {
            background: #fef3c7;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            color: #92400e;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: var(--bg-card);
            padding: 32px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 2px solid var(--border-color);
            min-height: 450px;
            display: flex;
            flex-direction: column;
        }

        .chart-container.auto-height {
            height: auto;
            min-height: 600px;
        }

        .chart-container h2 {
            margin-bottom: 10px;
            color: var(--text-primary);
            font-size: 22px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .chart-container p {
            flex-shrink: 0;
        }

        .chart-wrapper {
            flex: 1;
            position: relative;
            min-height: 0;
        }

        .chart-wrapper canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
        }

        .dividend-calendar {
            background: var(--bg-card);
            padding: 32px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 2px solid var(--border-color);
        }

        .dividend-calendar-header {
            margin-bottom: 8px;
        }

        .dividend-calendar-header h2 {
            font-size: 22px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .dividend-notice {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 10px 14px;
            margin: 12px 0;
            font-size: 12px;
            color: #92400e;
            line-height: 1.6;
        }

        .dividend-notice strong { font-weight: 700; }

        /* å¹´é–“åˆè¨ˆãƒãƒŠãƒ¼ */
        .dividend-total-banner {
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: 16px;
            padding: 24px 28px;
            margin-bottom: 24px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
        }

        .dividend-total-left .total-label {
            font-size: 13px;
            font-weight: 600;
            opacity: 0.85;
            margin-bottom: 4px;
        }

        .dividend-total-left .total-amount {
            font-size: 36px;
            font-weight: 900;
            font-family: 'JetBrains Mono', monospace;
            line-height: 1;
        }

        .dividend-total-left .total-subtitle {
            font-size: 12px;
            opacity: 0.75;
            margin-top: 4px;
        }

        .dividend-total-right {
            text-align: right;
        }

        .dividend-total-right .after-tax-label {
            font-size: 13px;
            opacity: 0.85;
            margin-bottom: 4px;
        }

        .dividend-total-right .after-tax-amount {
            font-size: 28px;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
        }

        .dividend-total-right .tax-note {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 4px;
        }

        /* æœˆã‚°ãƒªãƒƒãƒ‰ï¼š4åˆ—Ã—3è¡Œ */
        .month-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        @media (max-width: 900px) {
            .month-grid { grid-template-columns: repeat(3, 1fr); }
        }

        @media (max-width: 600px) {
            .month-grid { grid-template-columns: repeat(2, 1fr); }
        }

        .month-card {
            border-radius: 14px;
            padding: 16px;
            border: 2px solid var(--border-color);
            transition: all 0.25s ease;
            position: relative;
            overflow: hidden;
            cursor: default;
        }

        .month-card.has-dividend {
            background: white;
            border-color: #10b981;
        }

        .month-card.has-dividend:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(16,185,129,0.2);
        }

        .month-card.no-dividend {
            background: #f9fafb;
            border-color: #e5e7eb;
            opacity: 0.6;
        }

        /* æœˆãƒ©ãƒ™ãƒ« */
        .mc-month {
            font-size: 12px;
            font-weight: 700;
            color: #6b7280;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .month-card.has-dividend .mc-month {
            color: #059669;
        }

        /* ä¸»è¦é‡‘é¡ï¼ˆç¨å¼•å‰ï¼‰ */
        .mc-main-amount {
            font-size: 20px;
            font-weight: 900;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            line-height: 1.1;
            margin-bottom: 2px;
        }

        .mc-main-label {
            font-size: 10px;
            color: #9ca3af;
            margin-bottom: 8px;
        }

        /* ä»•åˆ‡ã‚Šç·š */
        .mc-divider {
            border: none;
            border-top: 1px dashed #e5e7eb;
            margin: 8px 0;
        }

        /* ç¨å¼•å¾Œé‡‘é¡ */
        .mc-after-amount {
            font-size: 15px;
            font-weight: 700;
            color: #10b981;
            font-family: 'JetBrains Mono', monospace;
        }

        .mc-after-label {
            font-size: 10px;
            color: #9ca3af;
        }

        /* é…å½“ãªã—ã‚«ãƒ¼ãƒ‰ */
        .mc-no-div-text {
            font-size: 13px;
            color: #9ca3af;
            margin-top: 8px;
        }

        /* ä»Šæœˆãƒã‚¤ãƒ©ã‚¤ãƒˆ */
        .month-card.current-month {
            border-color: #3b82f6 !important;
            box-shadow: 0 0 0 3px rgba(59,130,246,0.15);
        }

        .month-card.current-month .mc-month::after {
            content: ' â† ä»Šæœˆ';
            color: #3b82f6;
            font-size: 10px;
        }

        /* é…å½“æ ªãƒªã‚¹ãƒˆ */
        .mc-stocks-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 11px;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10;
        }

        .month-card:hover .mc-stocks-tooltip {
            opacity: 1;
        }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: fadeInUp 0.6s ease-out;
        }

        .no-data {
            text-align: center;
            padding: 80px 20px;
            background: white;
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 2px dashed var(--border-color);
        }

        .no-data-icon {
            font-size: 80px;
            margin-bottom: 24px;
            opacity: 0.5;
        }

        .no-data h3 {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 24px;
        }

        .no-data p {
            color: var(--text-muted);
            font-size: 16px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 32px;
            }
            
            .chart-grid {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 400px;
            }
            
            .fear-greed-widget {
                min-width: 100%;
            }
        }

        @media (max-width: 1200px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="animate-in">
            <div class="header-content">
                <div class="header-left">
                    <h1>ğŸ’° ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªç·åˆåˆ†æ</h1>
                    <p class="subtitle">æ¥½å¤©è¨¼åˆ¸ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ‹¬ç®¡ç†ãƒ»å¯è¦–åŒ–</p>
                </div>
                
                <!-- Fear & Greed: ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆæ¨ªä¸¦ã³ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
                <div class="fear-greed-widget" id="fearGreedWidget">
                    <div class="fgi-top-row">
                        <div class="fgi-left">
                            <div class="fear-greed-label">Fear &amp; Greed Index</div>
                            <div class="fear-greed-subtitle">å¸‚å ´ã®æ„Ÿæƒ…æŒ‡æ•°ï¼ˆCNNå…¬å¼ï¼‰</div>
                            <div class="fgi-score-row">
                                <div class="fear-greed-number" id="fearGreedValue">--</div>
                                <div class="fgi-status-col">
                                    <div class="fear-greed-status" id="fearGreedStatus">èª­ã¿è¾¼ã¿ä¸­...</div>
                                    <div class="fgi-comparison" id="fgiComparison"></div>
                                </div>
                            </div>
                        </div>
                        <div class="fgi-right">
                            <div class="fear-greed-gauge-container">
                                <svg id="fgSvg" viewBox="0 0 300 170" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M 30 150 A 120 120 0 0 1 72.4 42.8" fill="none" stroke="#e05c5c" stroke-width="28" stroke-linecap="butt" opacity="0.25" id="arc0"/>
                                    <path d="M 72.4 42.8 A 120 120 0 0 1 130 18.3" fill="none" stroke="#f0a050" stroke-width="28" stroke-linecap="butt" opacity="0.25" id="arc1"/>
                                    <path d="M 130 18.3 A 120 120 0 0 1 170 18.3" fill="none" stroke="#d4c44a" stroke-width="28" stroke-linecap="butt" opacity="0.25" id="arc2"/>
                                    <path d="M 170 18.3 A 120 120 0 0 1 227.6 42.8" fill="none" stroke="#8bc44a" stroke-width="28" stroke-linecap="butt" opacity="0.25" id="arc3"/>
                                    <path d="M 227.6 42.8 A 120 120 0 0 1 270 150" fill="none" stroke="#4aaa6a" stroke-width="28" stroke-linecap="butt" opacity="0.25" id="arc4"/>
                                    <text x="24" y="158" font-size="10" fill="#9ca3af" font-family="Arial" text-anchor="middle">0</text>
                                    <text x="68" y="52" font-size="9" fill="#9ca3af" font-family="Arial" text-anchor="middle">25</text>
                                    <text x="150" y="16" font-size="9" fill="#9ca3af" font-family="Arial" text-anchor="middle">50</text>
                                    <text x="232" y="52" font-size="9" fill="#9ca3af" font-family="Arial" text-anchor="middle">75</text>
                                    <text x="276" y="158" font-size="10" fill="#9ca3af" font-family="Arial" text-anchor="middle">100</text>
                                    <line id="gaugeNeedle" x1="150" y1="150" x2="150" y2="40" stroke="#1f2937" stroke-width="4" stroke-linecap="round" transform="rotate(-90, 150, 150)"/>
                                    <circle cx="150" cy="150" r="10" fill="#1f2937"/>
                                    <circle cx="150" cy="150" r="6" fill="white"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <!-- 7æŒ‡æ¨™ï¼šæ¨ª2åˆ—ã‚°ãƒªãƒƒãƒ‰ -->
                    <div class="fgi-indicators" id="fgiIndicators">
                        <div style="color:#9ca3af;font-size:12px;padding:8px 0">æŒ‡æ¨™ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...</div>
                    </div>
                </div>
            </div>
            
            <div class="upload-section">
                <div class="file-input-wrapper">
                    <label class="file-label">
                        <span>ğŸ“Š</span>
                        <span>æ¥½å¤©è¨¼åˆ¸CSV</span>
                        <input type="file" id="csvFileInput" accept=".csv" multiple />
                    </label>
                </div>
                <div id="uploadStatus"></div>
            </div>
        </header>

        <div class="info-card animate-in" style="animation-delay: 0.1s;">
            <h3>ğŸ“š ã“ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã§ãã‚‹ã“ã¨</h3>
            <ul>
                <li>æ ªå¼ãƒ»æŠ•è³‡ä¿¡è¨—ãƒ»iDeCoãƒ»å¤–å›½æ ªå¼ã‚’ä¸€æ‹¬ã§ç®¡ç†ãƒ»åˆ†æ</li>
                <li>ã©ã®æŠ•è³‡ãŒã„ãã‚‰å„²ã‹ã£ã¦ã„ã‚‹ã‹ä¸€ç›®ã§ç¢ºèª</li>
                <li>æ¥­ç•Œåˆ¥ã®æŠ•è³‡çŠ¶æ³ã‚’å¯è¦–åŒ–ï¼ˆä½•ä»¶æŠ•è³‡ã—ã¦ã„ã‚‹ã‹è¡¨ç¤ºï¼‰</li>
                <li>ã©ã®æ ªã‚’è²·ã„å¢—ã—ã™ã¹ãã‹ã€AIãŒæ•™ãˆã¦ãã‚Œã‚‹</li>
                <li>é…å½“é‡‘ã®äºˆæ¸¬ï¼ˆæ ªå¼ã®ã¿ï¼‰</li>
                <li>å¸‚å ´å…¨ä½“ã®é›°å›²æ°—ï¼ˆææ€–ã¨å¼·æ¬²æŒ‡æ•°ï¼‰ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º</li>
            </ul>
        </div>

        <div id="dashboard" style="display: none;">
            <div class="summary-cards">
                <div class="card animate-in" style="animation-delay: 0.2s;">
                    <span class="card-icon">ğŸ’</span>
                    <div class="card-title">ç·è³‡ç”£è©•ä¾¡é¡</div>
                    <div class="card-value" id="totalValue">Â¥0</div>
                    <div class="card-subtitle">ä»Šã€å…¨éƒ¨å£²ã£ãŸã‚‰ã“ã®é‡‘é¡</div>
                </div>
                <div class="card animate-in" style="animation-delay: 0.3s;">
                    <span class="card-icon">ğŸ“ˆ</span>
                    <div class="card-title">è©•ä¾¡æç›Š</div>
                    <div class="card-value" id="totalProfit">Â¥0</div>
                    <div class="card-subtitle" id="profitSubtitle">è²·ã£ãŸæ™‚ã‚ˆã‚Šå¢—ãˆãŸé‡‘é¡</div>
                </div>
                <div class="card animate-in" style="animation-delay: 0.4s;">
                    <span class="card-icon">ğŸ¯</span>
                    <div class="card-title">ãƒªã‚¿ãƒ¼ãƒ³ç‡</div>
                    <div class="card-value" id="profitRate">0%</div>
                    <div class="card-subtitle">æŠ•è³‡åŠ¹ç‡ã®æŒ‡æ¨™</div>
                </div>
                <div class="card animate-in" style="animation-delay: 0.5s;">
                    <span class="card-icon">ğŸ’µ</span>
                    <div class="card-title">å¹´é–“é…å½“é‡‘ï¼ˆç¨å¼•å‰ï¼‰</div>
                    <div class="card-value positive" id="annualDividendBefore">Â¥0</div>
                    <div class="card-subtitle">æºæ³‰å¾´åå‰ã®é…å½“é‡‘</div>
                </div>
                <div class="card animate-in" style="animation-delay: 0.6s;">
                    <span class="card-icon">ğŸ’°</span>
                    <div class="card-title">å¹´é–“é…å½“é‡‘ï¼ˆç¨å¼•å¾Œï¼‰</div>
                    <div class="card-value positive" id="annualDividendAfter">Â¥0</div>
                    <div class="card-subtitle">å®Ÿéš›ã«å—ã‘å–ã‚‹é‡‘é¡</div>
                </div>
                <div class="card animate-in" style="animation-delay: 0.7s;">
                    <span class="card-icon">â­</span>
                    <div class="card-title">ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªè©•ä¾¡</div>
                    <div class="card-value score" id="portfolioScore">--<span class="score-grade" id="portfolioGrade"></span></div>
                    <div class="card-subtitle" id="scoreComment">åˆ†æä¸­...</div>
                </div>
            </div>

            <div class="market-analysis animate-in" style="animation-delay: 0.8s;">
                <h2>ğŸŒ æœ¬æ—¥ã®å¸‚å ´çŠ¶æ³ã¨ä»Šæœˆã®æŠ•è³‡æˆ¦ç•¥</h2>
                <div id="marketAnalysisContent">
                    <p style="color: var(--text-muted); text-align: center;">ãƒ‡ãƒ¼ã‚¿åˆ†æä¸­...</p>
                </div>
            </div>

            <div class="industry-summary animate-in" style="animation-delay: 0.6s;" id="industrySummary">
                <h2>ğŸ¢ æ¥­ç•Œåˆ¥æŠ•è³‡ã‚µãƒãƒªãƒ¼</h2>
                <p style="color: var(--text-muted); margin-bottom: 20px; font-size: 14px;">ã©ã®æ¥­ç•Œã«ä½•éŠ˜æŸ„æŠ•è³‡ã—ã¦ã„ã‚‹ã‹</p>
                <div class="industry-grid" id="industryGrid"></div>
            </div>

            <div class="analysis-tabs animate-in" style="animation-delay: 0.7s;">
                <button class="tab-button active" onclick="switchTab('domestic')">ğŸ  å›½å†…æ ªå¼</button>
                <button class="tab-button" onclick="switchTab('foreign')">ğŸŒ å¤–å›½æ ªå¼</button>
                <button class="tab-button" onclick="switchTab('funds')">ğŸ“Š æŠ•ä¿¡ãƒ»iDeCo</button>
                <button class="tab-button" onclick="switchTab('analysis')">ğŸ” è©³ç´°åˆ†æ</button>
                <button class="tab-button" onclick="switchTab('dividend')">ğŸ’° é…å½“äºˆæ¸¬</button>
            </div>

            <div id="domesticTab" class="tab-content active">
                <div class="stock-table animate-in" style="animation-delay: 0.8s;">
                    <div class="table-header">
                        <h2>ğŸ  å›½å†…æ ªå¼</h2>
                        <p>æ—¥æœ¬ä¼æ¥­ã®ä¿æœ‰éŠ˜æŸ„ä¸€è¦§</p>
                    </div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>éŠ˜æŸ„</th>
                                    <th>æ¥­ç•Œ</th>
                                    <th>ä¿æœ‰æ•°</th>
                                    <th>å¹³å‡å–å¾—é¡</th>
                                    <th>ç¾åœ¨ä¾¡æ ¼</th>
                                    <th>è©•ä¾¡æç›Š</th>
                                    <th>æç›Šç‡</th>
                                    <th>æ™‚ä¾¡è©•ä¾¡é¡</th>
                                    <th>ã‚¢ãƒ‰ãƒã‚¤ã‚¹</th>
                                    <th>æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
                                    <th>åˆ†æç†ç”±</th>
                                </tr>
                            </thead>
                            <tbody id="domesticTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="foreignTab" class="tab-content">
                <div class="stock-table animate-in">
                    <div class="table-header" style="background: linear-gradient(135deg, #6366f1, #8b5cf6);">
                        <h2>ğŸŒ å¤–å›½æ ªå¼</h2>
                        <p>ç±³å›½æ ªãªã©ã®ä¿æœ‰éŠ˜æŸ„ä¸€è¦§</p>
                    </div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>ãƒ†ã‚£ãƒƒã‚«ãƒ¼</th>
                                    <th>éŠ˜æŸ„å</th>
                                    <th>ä¿æœ‰æ•°</th>
                                    <th>å¹³å‡å–å¾—é¡</th>
                                    <th>ç¾åœ¨ä¾¡æ ¼</th>
                                    <th>è©•ä¾¡æç›Š</th>
                                    <th>æç›Šç‡</th>
                                    <th>æ™‚ä¾¡è©•ä¾¡é¡</th>
                                    <th>ã‚¢ãƒ‰ãƒã‚¤ã‚¹</th>
                                    <th>æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</th>
                                    <th>åˆ†æç†ç”±</th>
                                </tr>
                            </thead>
                            <tbody id="foreignTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="fundsTab" class="tab-content">
                <div class="stock-table animate-in">
                    <div class="table-header" style="background: linear-gradient(135deg, #ec4899, #f43f5e);">
                        <h2>ğŸ“Š æŠ•è³‡ä¿¡è¨—ãƒ»iDeCo</h2>
                        <p>ä¿æœ‰ãƒ•ã‚¡ãƒ³ãƒ‰ã®ä¸€è¦§ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼ˆç‰¹å®šãƒ»NISAãƒ»iDeCoï¼‰</p>
                    </div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>ãƒ•ã‚¡ãƒ³ãƒ‰å</th>
                                    <th>å£åº§</th>
                                    <th>ä¿æœ‰å£æ•°</th>
                                    <th>å¹³å‡å–å¾—é¡</th>
                                    <th>åŸºæº–ä¾¡é¡</th>
                                    <th>è©•ä¾¡æç›Š</th>
                                    <th>æç›Šç‡</th>
                                    <th>æ™‚ä¾¡è©•ä¾¡é¡</th>
                                </tr>
                            </thead>
                            <tbody id="fundsTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="analysisTab" class="tab-content">
                <div class="chart-grid">
                    <div class="chart-container animate-in">
                        <h2>ğŸ“Š è³‡ç”£åˆ†é¡</h2>
                        <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 15px;">å›½å†…æ ªãƒ»å¤–å›½æ ªãƒ»æŠ•è³‡ä¿¡è¨—ã®å‰²åˆ</p>
                        <div class="chart-wrapper">
                            <canvas id="assetTypeChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container animate-in" style="animation-delay: 0.1s;">
                        <h2>ğŸ’¼ æ¥­ç•Œåˆ¥æŠ•è³‡é¡ï¼ˆå›½å†…æ ªï¼‰</h2>
                        <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 15px;">ã©ã®æ¥­ç•Œã«ã„ãã‚‰æŠ•è³‡ã—ã¦ã„ã‚‹ã‹</p>
                        <div class="chart-wrapper">
                            <canvas id="industryChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="chart-grid">
                    <div class="chart-container animate-in" style="animation-delay: 0.2s;" class="auto-height">
                        <h2>ğŸ† å›½å†…æ ªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h2>
                        <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 15px;">å…¨éŠ˜æŸ„ã®æç›Šç‡ãƒ©ãƒ³ã‚­ãƒ³ã‚°</p>
                        <div class="chart-wrapper">
                            <canvas id="domesticPerformanceChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-container animate-in auto-height" style="animation-delay: 0.3s;">
                        <h2>ğŸ† å¤–å›½æ ªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h2>
                        <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 15px;">å…¨éŠ˜æŸ„ã®æç›Šç‡ãƒ©ãƒ³ã‚­ãƒ³ã‚°</p>
                        <div class="chart-wrapper">
                            <canvas id="foreignPerformanceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div id="dividendTab" class="tab-content">
                <div class="dividend-calendar animate-in">
                    <div class="dividend-calendar-header">
                        <h2>ğŸ“… æœˆåˆ¥é…å½“é‡‘ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h2>
                        <p style="color:var(--text-muted);font-size:14px;margin-top:4px;">ã‚ãªãŸãŒæ¯æœˆã„ãã‚‰å—ã‘å–ã‚Œã‚‹ã‹ã®äºˆæ¸¬ã§ã™</p>
                    </div>

                    <div class="dividend-notice">
                        <strong>âš ï¸ è¨ˆç®—æ–¹æ³•ã«ã¤ã„ã¦ï¼ˆiGrowã¨ã®å·®ç•°ï¼‰</strong><br>
                        ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ <strong>ã€Œè©•ä¾¡é¡ Ã— é…å½“åˆ©å›ã‚Šæ¨å®šå€¤ã€</strong> ã§è¨ˆç®—ã—ã¦ã„ã¾ã™ã€‚
                        iGrowç­‰ã®ã‚¢ãƒ—ãƒªã¯ <strong>ã€Œ1æ ªã‚ãŸã‚Šé…å½“é¡ Ã— ä¿æœ‰æ ªæ•°ã€</strong> ã®å®Ÿç¸¾å€¤ã‚’ä½¿ã†ãŸã‚é‡‘é¡ãŒç•°ãªã‚Šã¾ã™ã€‚
                        ã‚ãã¾ã§<strong>ãŠãŠã‚ˆãã®ç›®å®‰</strong>ã¨ã—ã¦ã”åˆ©ç”¨ãã ã•ã„ã€‚
                    </div>

                    <!-- å¹´é–“åˆè¨ˆãƒãƒŠãƒ¼ -->
                    <div class="dividend-total-banner" id="dividendTotalBanner">
                        <div class="dividend-total-left">
                            <div class="total-label">ğŸ“Š å¹´é–“é…å½“äºˆæ¸¬ï¼ˆç¨å¼•å‰ï¼‰</div>
                            <div class="total-amount" id="divTotalBefore">Â¥--</div>
                            <div class="total-subtitle">å›½å†…æ ªå¼ã®é…å½“åˆè¨ˆ</div>
                        </div>
                        <div class="dividend-total-right">
                            <div class="after-tax-label">ğŸ¦ å®Ÿéš›ã«å—ã‘å–ã‚Œã‚‹é¡</div>
                            <div class="after-tax-amount" id="divTotalAfter">Â¥--</div>
                            <div class="tax-note">ç¨ç‡ 20.315% æ§é™¤å¾Œ</div>
                        </div>
                    </div>

                    <!-- 12ãƒ¶æœˆã‚°ãƒªãƒƒãƒ‰ -->
                    <div class="month-grid" id="monthlyDividend"></div>
                </div>
            </div>
        </div>

        <div id="noData" class="no-data animate-in">
            <div class="no-data-icon">ğŸ“Š</div>
            <h3>ã¾ã ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</h3>
            <p>æ¥½å¤©è¨¼åˆ¸ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸCSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„</p>
            <p style="margin-top: 10px; font-size: 14px;">è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åŒæ™‚é¸æŠå¯èƒ½ã§ã™</p>
        </div>

        <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="industryModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalIndustryName">-</h2>
                    <button class="modal-close" onclick="closeIndustryModal()">Ã—</button>
                </div>
                <div id="modalStockList"></div>
            </div>
        </div>
    </div>

    <script>
        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜ç”¨ï¼ˆåˆ†é¡ã”ã¨ï¼‰
        let domesticStocksData = []; // å›½å†…æ ªå¼
        let foreignStocksData = [];  // å¤–å›½æ ªå¼ï¼ˆç±³å›½æ ªãªã©ï¼‰
        let fundsData = [];          // æŠ•è³‡ä¿¡è¨—
        
        // çµ±åˆãƒ‡ãƒ¼ã‚¿
        let allStocksData = [];
        
        // å¸‚å ´å¿ƒç†æŒ‡æ•°
        let fearGreedIndex = null;
        
        // å……å®Ÿã—ãŸæ¥­ç•Œãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆé…å½“åˆ©å›ã‚Šã¨é…å½“æœˆã‚’è¿½åŠ ï¼‰
        const industryDatabase = {
            '1343': { name: 'ä¸å‹•ç”£', dividend: 3.5, months: [2, 8] }, // NFJ-REIT
            '1414': { name: 'å»ºè¨­', dividend: 3.2, months: [3, 9] }, // ã‚·ãƒ§ãƒ¼ãƒœãƒ³ãƒ‰HD
            '1489': { name: 'é‡‘è', dividend: 4.0, months: [1, 4, 7, 10] }, // æ—¥çµŒé«˜é…å½“50 (æ¯æœˆå‹ã¨ä»®å®š)
            '1928': { name: 'å»ºè¨­', dividend: 4.5, months: [1, 7] }, // ç©æ°´ãƒã‚¦ã‚¹
            '1951': { name: 'å»ºè¨­', dividend: 3.8, months: [3, 9] }, // ã‚¨ã‚¯ã‚·ã‚ªã‚°ãƒ«ãƒ¼ãƒ—
            '2003': { name: 'é£Ÿå“', dividend: 2.8, months: [3, 9] }, // æ—¥æ±å¯Œå£«è£½ç²‰
            '2124': { name: 'ã‚µãƒ¼ãƒ“ã‚¹', dividend: 2.5, months: [12] }, // JAC Recruitment
            '2169': { name: 'IT', dividend: 3.0, months: [3, 9] }, // CDS
            '2185': { name: 'IT', dividend: 3.5, months: [3, 9] }, // ã‚·ã‚¤ã‚¨ãƒ ãƒ»ã‚·ã‚¤
            '2269': { name: 'é£Ÿå“', dividend: 2.2, months: [3, 9] }, // æ˜æ²»HD
            '2317': { name: 'IT', dividend: 2.0, months: [3] }, // ã‚·ã‚¹ãƒ†ãƒŠ
            '2391': { name: 'ã‚µãƒ¼ãƒ“ã‚¹', dividend: 3.8, months: [3, 9] }, // ãƒ—ãƒ©ãƒãƒƒãƒˆ
            '2462': { name: 'ã‚µãƒ¼ãƒ“ã‚¹', dividend: 2.7, months: [3, 9] }, // ãƒ©ã‚¤ã‚¯
            '2502': { name: 'é£Ÿå“', dividend: 3.5, months: [12] }, // ã‚¢ã‚µãƒ’ã‚°ãƒ«ãƒ¼ãƒ—HD
            '2659': { name: 'å°å£²', dividend: 2.8, months: [2, 8] }, // ã‚µãƒ³ã‚¨ãƒ¼
            '3003': { name: 'ä¸å‹•ç”£', dividend: 3.5, months: [12] }, // ãƒ’ãƒ¥ãƒ¼ãƒªãƒƒã‚¯
            '3053': { name: 'ã‚µãƒ¼ãƒ“ã‚¹', dividend: 2.0, months: [12] }, // ãƒšãƒƒãƒ‘ãƒ¼ãƒ•ãƒ¼ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹
            '3076': { name: 'ã‚µãƒ¼ãƒ“ã‚¹', dividend: 3.2, months: [3, 9] }, // ã‚ã„HD
            '3231': { name: 'ä¸å‹•ç”£', dividend: 3.8, months: [3, 9] }, // é‡æ‘ä¸å‹•ç”£
            '3333': { name: 'å°å£²', dividend: 2.5, months: [2, 8] }, // ã‚ã•ã²
            '3771': { name: 'IT', dividend: 2.8, months: [3] }, // ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚µãƒ¼ãƒ
            '3817': { name: 'IT', dividend: 3.0, months: [3, 9] }, // SRA HD
            '3834': { name: 'IT', dividend: 2.5, months: [3] }, // æœæ—¥ãƒãƒƒãƒˆ
            '4008': { name: 'åŒ–å­¦', dividend: 3.2, months: [3, 9] }, // ä½å‹ç²¾åŒ–
            '4042': { name: 'åŒ–å­¦', dividend: 3.5, months: [3, 9] }, // æ±ã‚½ãƒ¼
            '4097': { name: 'åŒ–å­¦', dividend: 3.0, months: [3] }, // é«˜åœ§ã‚¬ã‚¹
            '4248': { name: 'è£½é€ ', dividend: 2.8, months: [3] }, // ç«¹æœ¬å®¹å™¨
            '4345': { name: 'IT', dividend: 2.5, months: [3] }, // ã‚·ãƒ¼ãƒ†ã‚£ãƒ¼ã‚¨ã‚¹
            '4401': { name: 'åŒ–å­¦', dividend: 3.0, months: [3, 9] }, // ADEKA
            '4540': { name: 'åŒ»è–¬å“', dividend: 2.5, months: [3, 9] }, // ãƒ„ãƒ ãƒ©
            '4661': { name: 'ã‚¨ãƒ³ã‚¿ãƒ¡', dividend: 1.5, months: [3, 9] }, // ã‚ªãƒªã‚¨ãƒ³ã‚¿ãƒ«ãƒ©ãƒ³ãƒ‰
            '4719': { name: 'IT', dividend: 2.8, months: [3] }, // ã‚¢ãƒ«ãƒ•ã‚¡ã‚·ã‚¹ãƒ†ãƒ ã‚º
            '4752': { name: 'IT', dividend: 2.5, months: [3] }, // æ˜­å’Œã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢
            '4832': { name: 'IT', dividend: 2.8, months: [3] }, // JFEã‚·ã‚¹ãƒ†ãƒ ã‚º
            '4972': { name: 'åŒ–å­¦', dividend: 3.0, months: [3] }, // ç¶œç ”åŒ–å­¦
            '5388': { name: 'åŒ–å­¦', dividend: 3.2, months: [3] }, // ã‚¯ãƒ‹ãƒŸãƒå·¥æ¥­
            '6073': { name: 'ã‚µãƒ¼ãƒ“ã‚¹', dividend: 3.5, months: [3, 9] }, // ã‚¢ã‚µãƒ³ãƒ†
            '6345': { name: 'æ©Ÿæ¢°', dividend: 3.0, months: [3] }, // ã‚¢ã‚¤ãƒã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            '6432': { name: 'æ©Ÿæ¢°', dividend: 2.8, months: [3] }, // ç«¹å†…è£½ä½œæ‰€
            '6458': { name: 'æ©Ÿæ¢°', dividend: 3.2, months: [3] }, // æ–°æ™ƒå·¥æ¥­
            '6539': { name: 'ã‚µãƒ¼ãƒ“ã‚¹', dividend: 2.5, months: [3, 9] }, // MS-Japan
            '6652': { name: 'æ©Ÿæ¢°', dividend: 3.0, months: [3] }, // IDEC
            '6785': { name: 'æ©Ÿæ¢°', dividend: 3.2, months: [3] }, // éˆ´æœ¨
            '7723': { name: 'æ©Ÿæ¢°', dividend: 3.5, months: [3] }, // æ„›çŸ¥æ™‚è¨ˆ
            '7749': { name: 'åŒ»è–¬å“', dividend: 2.8, months: [3, 9] }, // ãƒ¡ãƒ‡ã‚£ã‚­ãƒƒãƒˆ
            '7820': { name: 'è£½é€ ', dividend: 3.0, months: [3] }, // ãƒ‹ãƒ›ãƒ³ãƒ•ãƒ©ãƒƒã‚·ãƒ¥
            '7860': { name: 'ã‚¨ãƒ³ã‚¿ãƒ¡', dividend: 2.0, months: [3, 9] }, // ã‚¨ã‚¤ãƒ™ãƒƒã‚¯ã‚¹
            '7989': { name: 'è£½é€ ', dividend: 3.2, months: [12] }, // ç«‹å·ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰
            '7994': { name: 'è£½é€ ', dividend: 3.0, months: [3] }, // ã‚ªã‚«ãƒ ãƒ©
            '8058': { name: 'å•†ç¤¾', dividend: 4.5, months: [3, 9] }, // ä¸‰è±å•†äº‹
            '8130': { name: 'å°å£²', dividend: 3.2, months: [3, 9] }, // ã‚µãƒ³ã‚²ãƒ„
            '8309': { name: 'é‡‘è', dividend: 4.0, months: [3, 9] }, // ä¸‰äº•ä½å‹ãƒˆãƒ©ã‚¹ãƒˆ
            '8584': { name: 'é‡‘è', dividend: 3.8, months: [3, 9] }, // ã‚¸ãƒ£ãƒƒã‚¯ã‚¹
            '8593': { name: 'é‡‘è', dividend: 4.2, months: [3, 9] }, // ä¸‰è±HCã‚­ãƒ£ãƒ”ã‚¿ãƒ«
            '9432': { name: 'IT', dividend: 2.5, months: [3, 9] }, // NTT
        };

        // ç¨ç‡å®šæ•°ï¼ˆé…å½“é‡‘ã®æºæ³‰å¾´åç¨ç‡: 20.315%ï¼‰
        const TAX_RATE = 0.20315;

        let assetTypeChart = null;
        let industryChart = null;
        let domesticPerformanceChart = null;
        let foreignPerformanceChart = null;

        async function fetchFearGreedIndex() {
            try {
                // CNNå…¬å¼ãƒ‡ãƒ¼ã‚¿APIã‚’ä½¿ç”¨
                const response = await fetch(
                    'https://production.dataviz.cnn.io/index/fearandgreed/graphdata',
                    { headers: { 'User-Agent': 'Mozilla/5.0' } }
                );
                const data = await response.json();
                const fg = data.fear_and_greed;
                const value = Math.round(fg.score);

                fearGreedIndex = value;

                // é‡ã®è§’åº¦: -90åº¦(0)ã€œ+90åº¦(100)
                const angle = (value / 100) * 180 - 90;
                const needle = document.getElementById('gaugeNeedle');
                if (needle) needle.setAttribute('transform', `rotate(${angle}, 150, 150)`);

                // ã‚¾ãƒ¼ãƒ³è‰²ãƒ»ãƒ©ãƒ™ãƒ«
                let color, statusText, activeArc;
                if (value < 25) {
                    color = '#e05c5c'; statusText = 'EXTREME FEAR'; activeArc = 'arc0';
                } else if (value < 45) {
                    color = '#f0a050'; statusText = 'FEAR'; activeArc = 'arc1';
                } else if (value < 55) {
                    color = '#d4c44a'; statusText = 'NEUTRAL'; activeArc = 'arc2';
                } else if (value < 75) {
                    color = '#8bc44a'; statusText = 'GREED'; activeArc = 'arc3';
                } else {
                    color = '#4aaa6a'; statusText = 'EXTREME GREED'; activeArc = 'arc4';
                }

                ['arc0','arc1','arc2','arc3','arc4'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.setAttribute('opacity', id === activeArc ? '1' : '0.2');
                });

                document.getElementById('fearGreedValue').textContent = value;
                document.getElementById('fearGreedValue').style.color = color;
                document.getElementById('fearGreedStatus').textContent = statusText;
                document.getElementById('fearGreedStatus').style.color = color;

                // 7ã¤ã®æŒ‡æ¨™ã‚’è¡¨ç¤º
                const indicators = [
                    { key: 'market_momentum_sp500',   label: 'ğŸ“ˆ S&P500ãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ ',    desc: 'S&P500ã®125æ—¥ç§»å‹•å¹³å‡ã¨ã®ä¹–é›¢' },
                    { key: 'stock_price_strength',    label: 'ğŸ’ª æ ªä¾¡å¼·åº¦',            desc: 'NYSE 52é€±é«˜å€¤/å®‰å€¤ã®æ¯”ç‡' },
                    { key: 'stock_price_breadth',     label: 'ğŸ“Š æ ªä¾¡å¹…',              desc: 'å€¤ä¸ŠãŒã‚Š/å€¤ä¸‹ãŒã‚Šå‡ºæ¥é«˜ã®æ¯”ç‡' },
                    { key: 'put_call_options',        label: 'âš–ï¸ ãƒ—ãƒƒãƒˆ/ã‚³ãƒ¼ãƒ«æ¯”ç‡',    desc: 'å£²ã‚Šã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨è²·ã„ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ¯”ç‡' },
                    { key: 'market_volatility_vix',   label: 'ğŸŒŠ VIXï¼ˆææ€–æŒ‡æ•°ï¼‰',     desc: 'VIXã¨50æ—¥ç§»å‹•å¹³å‡ã®ä¹–é›¢' },
                    { key: 'junk_bond_demand',        label: 'ğŸ”— ã‚¸ãƒ£ãƒ³ã‚¯å‚µéœ€è¦',       desc: 'é«˜ãƒªã‚¹ã‚¯å‚µã¨æŠ•è³‡é©æ ¼å‚µã®åˆ©å›ã‚Šå·®' },
                    { key: 'safe_haven_demand',       label: 'ğŸ¦ å®‰å…¨è³‡ç”£éœ€è¦',         desc: 'æ ªå¼ã¨å›½å‚µã®ãƒªã‚¿ãƒ¼ãƒ³å·®' },
                ];

                const container = document.getElementById('fgiIndicators');
                if (container) {
                    container.innerHTML = indicators.map(ind => {
                        const item = data[ind.key];
                        if (!item) return '';
                        const s = Math.round(item.score);
                        let iColor, iLabel;
                        if (s < 25)      { iColor = '#e05c5c'; iLabel = 'æ¥µåº¦ã®ææ€–'; }
                        else if (s < 45) { iColor = '#f0a050'; iLabel = 'ææ€–'; }
                        else if (s < 55) { iColor = '#6b7280'; iLabel = 'ä¸­ç«‹'; }
                        else if (s < 75) { iColor = '#8bc44a'; iLabel = 'å¼·æ¬²'; }
                        else             { iColor = '#4aaa6a'; iLabel = 'æ¥µåº¦ã®å¼·æ¬²'; }

                        const barW = Math.max(2, s);
                        return `
                        <div class="fgi-indicator-row">
                            <div class="fgi-ind-header">
                                <span class="fgi-ind-label">${ind.label}</span>
                                <span class="fgi-ind-score" style="color:${iColor}">${s} <small style="font-size:11px">${iLabel}</small></span>
                            </div>
                            <div class="fgi-bar-bg">
                                <div class="fgi-bar-fill" style="width:${barW}%;background:${iColor}"></div>
                            </div>
                            <div class="fgi-ind-desc">${ind.desc}</div>
                        </div>`;
                    }).join('');
                }

                // å‰å›æ¯”è¼ƒ
                const prevEl = document.getElementById('fgiComparison');
                if (prevEl && fg.previous_close) {
                    const prev = Math.round(fg.previous_close);
                    const diff = value - prev;
                    prevEl.innerHTML = `å‰æ—¥ <strong>${prev}</strong> â†’ æœ¬æ—¥ <strong style="color:${color}">${value}</strong>
                        <span style="color:${diff >= 0 ? '#10b981' : '#ef4444'};font-weight:700">
                            ${diff >= 0 ? 'â–²' : 'â–¼'}${Math.abs(diff)}
                        </span>`;
                }

            } catch (error) {
                console.error('CNN Fear & Greed API ã‚¨ãƒ©ãƒ¼:', error);
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: alternative.me API
                try {
                    const r2 = await fetch('https://api.alternative.me/fng/?limit=1');
                    const d2 = await r2.json();
                    const v2 = parseInt(d2.data[0].value);
                    fearGreedIndex = v2;
                    document.getElementById('fearGreedValue').textContent = v2;
                    document.getElementById('fearGreedStatus').textContent = d2.data[0].value_classification.toUpperCase();
                    const angle = (v2 / 100) * 180 - 90;
                    const needle = document.getElementById('gaugeNeedle');
                    if (needle) needle.setAttribute('transform', `rotate(${angle}, 150, 150)`);
                } catch(e) {
                    document.getElementById('fearGreedValue').textContent = '--';
                    document.getElementById('fearGreedStatus').textContent = 'å–å¾—å¤±æ•—';
                }
            }
        }

        function generateActionAdvice(stock) {
            const priceChange = stock.priceChange;
            const profitRate = stock.profitRate;
            const currentPrice = stock.currentPrice;
            const avgPrice = stock.avgPrice;
            
            let action = '';
            let reason = '';
            
            // å¼·æ¬²å¸‚å ´ã§å¤§å¹…ä¸‹è½ï¼ˆçµ¶å¥½ã®è²·ã„å ´ï¼‰
            if (fearGreedIndex && fearGreedIndex > 60 && priceChange <= -15) {
                const limitPrice = Math.round(currentPrice * 0.98);
                action = `è²·ã„å¢—ã— 100æ ª`;
                reason = `å¸‚å ´ãŒ<span class="reason-highlight">å¼·æ¬²ï¼ˆ${fearGreedIndex}ï¼‰</span>ãªä¸­ã§<span class="reason-highlight">${Math.abs(priceChange).toFixed(1)}%ä¸‹è½</span>ã€‚èª¿æ•´å±€é¢ã§çµ¶å¥½ã®è²·ã„å ´ã€‚æŒ‡å€¤ <span class="reason-highlight">Â¥${limitPrice.toLocaleString()}</span> ã§å¾…æ©Ÿæ¨å¥¨`;
            }
            // ææ€–å¸‚å ´ã§å¤§å¹…ä¸‹è½ï¼ˆæ…é‡ã«è²·ã„å¢—ã—ï¼‰
            else if (fearGreedIndex && fearGreedIndex < 40 && priceChange <= -15) {
                const limitPrice = Math.round(currentPrice * 0.95);
                action = `è²·ã„å¢—ã— 100æ ª`;
                reason = `å¸‚å ´ãŒ<span class="reason-highlight">ææ€–ï¼ˆ${fearGreedIndex}ï¼‰</span>ã§<span class="reason-highlight">${Math.abs(priceChange).toFixed(1)}%ä¸‹è½</span>ã€‚ãƒ‘ãƒ‹ãƒƒã‚¯å£²ã‚Šã®å¯èƒ½æ€§ã‚ã‚Šã€‚æŒ‡å€¤ <span class="reason-highlight">Â¥${limitPrice.toLocaleString()}</span> ã§ã•ã‚‰ãªã‚‹ä¸‹è½ã«å‚™ãˆã‚‹`;
            }
            // é€šå¸¸ã®è²·ã„å¢—ã—ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼ˆ-10%ã€œ-15%ï¼‰
            else if (priceChange <= -10 && priceChange > -15) {
                const limitPrice = Math.round(currentPrice * 0.97);
                action = `è²·ã„å¢—ã— 100æ ª`;
                reason = `<span class="reason-highlight">${Math.abs(priceChange).toFixed(1)}%èª¿æ•´</span>ã§æŠ¼ã—ç›®å½¢æˆã€‚æŒ‡å€¤ <span class="reason-highlight">Â¥${limitPrice.toLocaleString()}</span> ã§æŠ¼ã—ç›®è²·ã„ã®ãƒãƒ£ãƒ³ã‚¹`;
            }
            // ä¸­ç¨‹åº¦ã®ä¸‹è½ï¼ˆæ§˜å­è¦‹ã ãŒæ¡ä»¶æ¬¡ç¬¬ã§è²·ã„ï¼‰
            else if (priceChange <= -7 && priceChange > -10) {
                const limitPrice = Math.round(currentPrice * 0.96);
                action = `-`;
                reason = `<span class="reason-highlight">${Math.abs(priceChange).toFixed(1)}%ä¸‹è½</span>ã€‚ã¾ã è²·ã„å ´ã§ã¯ãªã„ãŒã€æŒ‡å€¤ <span class="reason-highlight">Â¥${limitPrice.toLocaleString()}</span> ã§ä¸‹å€¤ã‚’æ‹¾ã†æº–å‚™ã‚‚æ¤œè¨`;
            }
            // å¤§å¹…ä¸Šæ˜‡ï¼ˆåˆ©ç›Šç¢ºå®šæ¨å¥¨ï¼‰
            else if (profitRate > 50) {
                const targetPrice = Math.round(currentPrice * 1.02);
                action = `å£²å´ 100æ ª`;
                reason = `<span class="reason-highlight">+${profitRate.toFixed(1)}%ã®å¤§å¹…åˆ©ç›Š</span>ã€‚éƒ¨åˆ†åˆ©ç¢ºã§åˆ©ç›Šã‚’ç¢ºå®šã€‚æŒ‡å€¤ <span class="reason-highlight">Â¥${targetPrice.toLocaleString()}</span> ã§å°‘ã—ã§ã‚‚é«˜å€¤ã‚’ç‹™ã†`;
            }
            // ä¸­ç¨‹åº¦ã®ä¸Šæ˜‡ï¼ˆ30%ã€œ50%ï¼‰
            else if (profitRate > 30 && profitRate <= 50) {
                action = `-`;
                reason = `<span class="reason-highlight">+${profitRate.toFixed(1)}%</span>ã¨å¥½èª¿ã‚’ç¶­æŒã€‚ã¾ã ä¸Šæ˜‡ä½™åœ°ã‚ã‚Šã€‚ç¾åœ¨ä¾¡æ ¼ <span class="reason-highlight">Â¥${currentPrice.toLocaleString()}</span> ã‹ã‚‰-10%ã§è²·ã„å¢—ã—æ¤œè¨`;
            }
            // è»½å¾®ã€œä¸­ç¨‹åº¦ã®ä¸Šæ˜‡ï¼ˆ10%ã€œ30%ï¼‰
            else if (profitRate > 10 && profitRate <= 30) {
                action = `-`;
                reason = `<span class="reason-highlight">+${profitRate.toFixed(1)}%</span>ã€‚é †èª¿ã«æ¨ç§»ä¸­ã€‚å–å¾—å˜ä¾¡ <span class="reason-highlight">Â¥${avgPrice.toLocaleString()}</span> ã‹ã‚‰<span class="reason-highlight">ã•ã‚‰ã«+20%</span>ã¾ã§ä¿æŒç¶™ç¶š`;
            }
            // å°å¹…ãªåˆ©ç›Šï¼ˆ0%ã€œ10%ï¼‰
            else if (profitRate > 0 && profitRate <= 10) {
                action = `-`;
                reason = `<span class="reason-highlight">+${profitRate.toFixed(1)}%</span>ã®å«ã¿ç›Šã€‚ã¾ã åˆ©ç¢ºã«ã¯æ—©ã„ã€‚å¸‚å ´å…¨ä½“ã®å‹•å‘ã‚’è¦‹ãªãŒã‚‰é•·æœŸä¿æœ‰ç¶™ç¶š`;
            }
            // è»½å¾®ãªæå¤±ï¼ˆ0%ã€œ-7%ï¼‰
            else if (profitRate < 0 && profitRate > -7) {
                action = `-`;
                reason = `<span class="reason-highlight">${profitRate.toFixed(1)}%ã®å«ã¿æ</span>ã€‚èª¤å·®ã®ç¯„å›²å†…ã€‚é•·æœŸæŠ•è³‡ã®è¦³ç‚¹ã‹ã‚‰ä¿æœ‰ç¶™ç¶šã€‚<span class="reason-highlight">-10%</span>ã§è²·ã„å¢—ã—æ¤œè¨`;
            }
            // ä¸­ç¨‹åº¦ã®æå¤±ï¼ˆ-7%ã€œ-15%ï¼‰
            else if (profitRate <= -7 && profitRate > -15) {
                action = `-`;
                reason = `<span class="reason-highlight">${profitRate.toFixed(1)}%ã®å«ã¿æ</span>ã€‚ãƒŠãƒ³ãƒ”ãƒ³å€™è£œã ãŒã€ã¾ã å¾…ã¡ã€‚å–å¾—å˜ä¾¡ã‚’ä¸‹ã’ã‚‹ãªã‚‰<span class="reason-highlight">-15%ä»¥é™</span>ãŒç›®å®‰`;
            }
            // å¤§å¹…ãªæå¤±ï¼ˆ-15%ä»¥ä¸Šï¼‰
            else if (profitRate <= -15) {
                const limitPrice = Math.round(currentPrice * 0.97);
                action = `-`;
                reason = `<span class="reason-highlight">${profitRate.toFixed(1)}%ã®å¤§å¹…å«ã¿æ</span>ã€‚ãƒŠãƒ³ãƒ”ãƒ³ã§å¹³å‡å–å¾—å˜ä¾¡ã‚’ä¸‹ã’ã‚‹ãƒãƒ£ãƒ³ã‚¹ã€‚æŒ‡å€¤ <span class="reason-highlight">Â¥${limitPrice.toLocaleString()}</span> ã§100æ ªã®è²·ã„å¢—ã—ã‚’æ¤œè¨`;
            }
            // ãã®ä»–ï¼ˆé€šå¸¸æ™‚ï¼‰
            else {
                action = `-`;
                reason = `ç¾åœ¨ä¾¡æ ¼ <span class="reason-highlight">Â¥${currentPrice.toLocaleString()}</span>ã€‚å¤§ããªå¤‰å‹•ãªã—ã€‚<span class="reason-highlight">Â±10%</span>ã®å¤‰å‹•ã§å£²è²·æ¤œè¨`;
            }
            
            return { action, reason };
        }

        function calculatePortfolioScore(domesticStocks, foreignStocks, funds, profitRate) {
            let score = 50; // åŸºæº–ç‚¹
            let comments = [];
            
            // 1. ãƒªã‚¿ãƒ¼ãƒ³ç‡ã«ã‚ˆã‚‹è©•ä¾¡ï¼ˆæœ€å¤§30ç‚¹ï¼‰
            if (profitRate > 30) {
                score += 30;
                comments.push('å„ªç§€ãªãƒªã‚¿ãƒ¼ãƒ³');
            } else if (profitRate > 20) {
                score += 25;
                comments.push('è‰¯å¥½ãªãƒªã‚¿ãƒ¼ãƒ³');
            } else if (profitRate > 10) {
                score += 20;
                comments.push('å …å®Ÿãªãƒªã‚¿ãƒ¼ãƒ³');
            } else if (profitRate > 5) {
                score += 15;
                comments.push('å®‰å®šé‹ç”¨');
            } else if (profitRate > 0) {
                score += 10;
                comments.push('ãƒ—ãƒ©ã‚¹ç¶­æŒ');
            } else if (profitRate > -5) {
                score += 5;
                comments.push('è»½å¾®ãªæå¤±');
            } else {
                score += 0;
                comments.push('æ”¹å–„ã®ä½™åœ°ã‚ã‚Š');
            }
            
            // 2. åˆ†æ•£æŠ•è³‡ã«ã‚ˆã‚‹è©•ä¾¡ï¼ˆæœ€å¤§20ç‚¹ï¼‰
            const totalStocks = domesticStocks.length + foreignStocks.length;
            if (totalStocks >= 30) {
                score += 20;
                comments.push('ååˆ†ã«åˆ†æ•£');
            } else if (totalStocks >= 20) {
                score += 15;
                comments.push('é©åº¦ã«åˆ†æ•£');
            } else if (totalStocks >= 10) {
                score += 10;
                comments.push('ã‚„ã‚„é›†ä¸­');
            } else {
                score += 5;
                comments.push('åˆ†æ•£ä¸è¶³');
            }
            
            // 3. æ¥­ç•Œåˆ†æ•£ï¼ˆæœ€å¤§15ç‚¹ï¼‰
            const industries = {};
            domesticStocks.forEach(s => {
                industries[s.industry] = (industries[s.industry] || 0) + 1;
            });
            const industryCount = Object.keys(industries).length;
            if (industryCount >= 8) {
                score += 15;
            } else if (industryCount >= 5) {
                score += 10;
            } else {
                score += 5;
            }
            
            // 4. å›½éš›åˆ†æ•£ï¼ˆæœ€å¤§10ç‚¹ï¼‰
            if (foreignStocks.length > 0 && funds.length > 0) {
                score += 10;
                comments.push('å›½éš›åˆ†æ•£OK');
            } else if (foreignStocks.length > 0 || funds.length > 0) {
                score += 5;
            }
            
            // 5. ãƒœãƒ¼ãƒŠã‚¹ç‚¹ï¼šé…å½“æ ªä¿æœ‰
            const hasHighDividend = domesticStocks.some(s => {
                const info = industryDatabase[s.code];
                return info && info.dividend >= 3.5;
            });
            if (hasHighDividend) {
                score += 5;
                comments.push('é«˜é…å½“æ ªä¿æœ‰');
            }
            
            // ã‚¹ã‚³ã‚¢ã‚’100ç‚¹æº€ç‚¹ã«èª¿æ•´
            score = Math.min(100, Math.max(0, score));
            
            // ã‚°ãƒ¬ãƒ¼ãƒ‰åˆ¤å®š
            let grade = '';
            if (score >= 90) grade = 'S';
            else if (score >= 80) grade = 'A';
            else if (score >= 70) grade = 'B';
            else if (score >= 60) grade = 'C';
            else grade = 'D';
            
            return { score, grade, comments };
        }

        function generateMarketAnalysis(profitRate, fearGreed, domesticStocks) {
            const today = new Date();
            const month = today.getMonth() + 1;
            const year = today.getFullYear();
            
            let marketSentiment = '';
            let strategy = [];
            
            // å¸‚å ´å¿ƒç†ã®åˆ†æ
            if (fearGreed >= 75) {
                marketSentiment = `å¸‚å ´ã¯<span class="analysis-highlight">æ¥µåº¦ã®å¼·æ¬²ï¼ˆ${fearGreed}ï¼‰</span>çŠ¶æ…‹ã€‚æŠ•è³‡å®¶ãŒæ¥½è¦³çš„ã™ãã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€èª¿æ•´å±€é¢ã«å…¥ã‚‹ãƒªã‚¹ã‚¯ãŒé«˜ã¾ã£ã¦ã„ã¾ã™ã€‚`;
                strategy.push('åˆ©ç›Šç¢ºå®šã‚’æ¤œè¨ï¼š+50%ä»¥ä¸Šã®éŠ˜æŸ„ã¯éƒ¨åˆ†å£²å´ã‚‚è¦–é‡ã«');
                strategy.push('æ–°è¦è³¼å…¥ã¯æ…é‡ã«ï¼šé«˜å€¤æ´ã¿ã®ãƒªã‚¹ã‚¯ã‚ã‚Š');
                strategy.push('ç¾é‡‘æ¯”ç‡ã‚’ä¸Šã’ã‚‹ï¼šæ¬¡ã®èª¿æ•´å±€é¢ã«å‚™ãˆã‚‹');
            } else if (fearGreed >= 55) {
                marketSentiment = `å¸‚å ´ã¯<span class="analysis-highlight">å¼·æ¬²ï¼ˆ${fearGreed}ï¼‰</span>å‚¾å‘ã€‚ä¸Šæ˜‡ãƒˆãƒ¬ãƒ³ãƒ‰ç¶™ç¶šä¸­ã§ã™ãŒã€éç†±æ„Ÿã«ã¯æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚`;
                strategy.push('ä¿æœ‰ç¶™ç¶šãŒåŸºæœ¬ï¼šãƒˆãƒ¬ãƒ³ãƒ‰ã«ä¹—ã‚‹');
                strategy.push('æŠ¼ã—ç›®å¾…ã¡ï¼š-10%ã®èª¿æ•´ã§è²·ã„å¢—ã—');
                strategy.push('ä¸€éƒ¨åˆ©ç¢ºï¼š+40%è¶…ãˆã¯æ¤œè¨ä½™åœ°ã‚ã‚Š');
            } else if (fearGreed >= 45) {
                marketSentiment = `å¸‚å ´ã¯<span class="analysis-highlight">ä¸­ç«‹ï¼ˆ${fearGreed}ï¼‰</span>ã€‚æ–¹å‘æ„ŸãŒå®šã¾ã£ã¦ã„ãªã„çŠ¶æ…‹ã§ã™ã€‚`;
                strategy.push('æ§˜å­è¦‹ãŒè³¢æ˜ï¼šå¤§ããªå‹•ãã‚’å¾…ã¤');
                strategy.push('åˆ†æ•£æŠ•è³‡ã‚’ç¶™ç¶šï¼šãƒªã‚¹ã‚¯ç®¡ç†ã‚’å¾¹åº•');
                strategy.push('ã‚¦ã‚©ãƒƒãƒãƒªã‚¹ãƒˆä½œæˆï¼šè²·ã„å ´ã‚’æ¢ã™');
            } else if (fearGreed >= 25) {
                marketSentiment = `å¸‚å ´ã¯<span class="analysis-highlight">ææ€–ï¼ˆ${fearGreed}ï¼‰</span>çŠ¶æ…‹ã€‚å£²ã‚ŠãŒå£²ã‚Šã‚’å‘¼ã¶å±•é–‹ã§ã™ãŒã€å„ªè‰¯æ ªã®è²·ã„å ´ã¨ãªã‚‹å¯èƒ½æ€§ã‚‚ã€‚`;
                strategy.push('å„ªè‰¯æ ªã®æŠ¼ã—ç›®è²·ã„ï¼š-15%ä»¥ä¸Šã®èª¿æ•´ã¯å¥½æ©Ÿ');
                strategy.push('ãƒŠãƒ³ãƒ”ãƒ³æ¤œè¨ï¼šä¿æœ‰æ ªã®å¹³å‡å–å¾—å˜ä¾¡ã‚’ä¸‹ã’ã‚‹');
                strategy.push('ç¾é‡‘æ¸©å­˜ï¼šã•ã‚‰ãªã‚‹ä¸‹è½ã«å‚™ãˆã‚‹ä½™åŠ›ã‚‚æ®‹ã™');
            } else {
                marketSentiment = `å¸‚å ´ã¯<span class="analysis-highlight">æ¥µåº¦ã®ææ€–ï¼ˆ${fearGreed}ï¼‰</span>ã€‚ãƒ‘ãƒ‹ãƒƒã‚¯å£²ã‚Šã®æ§˜ç›¸ã§ã™ãŒã€é•·æœŸæŠ•è³‡å®¶ã«ã¯çµ¶å¥½ã®è²·ã„å ´ã¨ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`;
                strategy.push('ç©æ¥µçš„ãªè²·ã„å¢—ã—ï¼šå„ªè‰¯æ ªã‚’æ‹¾ã†çµ¶å¥½æ©Ÿ');
                strategy.push('åˆ†å‰²è³¼å…¥ã‚’æ¨å¥¨ï¼šä¸€åº¦ã«å…¨é¡æŠ•å…¥ã›ãšã€3-4å›ã«åˆ†ã‘ã¦');
                strategy.push('é•·æœŸç›®ç·šã§ä¿æŒï¼šçŸ­æœŸã®å€¤å‹•ãã«æƒ‘ã‚ã•ã‚Œãªã„');
            }
            
            // ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«åŸºã¥ãã‚¢ãƒ‰ãƒã‚¤ã‚¹
            let portfolioAdvice = '';
            if (profitRate > 20) {
                portfolioAdvice = `ã‚ãªãŸã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã¯<span class="analysis-highlight">+${profitRate.toFixed(1)}%</span>ã¨å¸‚å ´å¹³å‡ã‚’ä¸Šå›ã‚‹å¥½æˆç¸¾ã€‚ã“ã®èª¿å­ã‚’ç¶­æŒã—ã¤ã¤ã€éåº¦ãªãƒªã‚¹ã‚¯ã¯é¿ã‘ã¾ã—ã‚‡ã†ã€‚`;
            } else if (profitRate > 0) {
                portfolioAdvice = `ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªã¯<span class="analysis-highlight">+${profitRate.toFixed(1)}%</span>ã®ãƒ—ãƒ©ã‚¹ã€‚ç€å®Ÿãªæˆé•·è·¯ç·šã§ã™ã€‚`;
            } else {
                portfolioAdvice = `ç¾åœ¨<span class="analysis-highlight">${profitRate.toFixed(1)}%</span>ã®å«ã¿æã§ã™ãŒã€é•·æœŸæŠ•è³‡ãªã‚‰ä¸€æ™‚çš„ãªèª¿æ•´ã€‚ç„¦ã‚‰ãšä¿æœ‰ç¶™ç¶šã‚’ã€‚`;
            }
            
            return `
                <div class="analysis-section">
                    <h3>ğŸ“Š ${year}å¹´${month}æœˆã®å¸‚å ´çŠ¶æ³</h3>
                    <p class="analysis-text">${marketSentiment}</p>
                </div>
                <div class="analysis-section">
                    <h3>ğŸ’¼ ã‚ãªãŸã®ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª</h3>
                    <p class="analysis-text">${portfolioAdvice}</p>
                </div>
                <div class="analysis-section">
                    <h3>ğŸ¯ ä»Šæœˆã®æ¨å¥¨æˆ¦ç•¥</h3>
                    <ul class="strategy-list">
                        ${strategy.map(s => `<li>${s}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        function getJapaneseClassification(classification) {
            const map = {
                'Extreme Fear': 'ğŸ¥¶ æ¥µåº¦ã®ææ€–',
                'Fear': 'ğŸ˜° ææ€–',
                'Neutral': 'ğŸ˜ ä¸­ç«‹',
                'Greed': 'ğŸ˜Š å¼·æ¬²',
                'Extreme Greed': 'ğŸ¤‘ æ¥µåº¦ã®å¼·æ¬²'
            };
            return map[classification] || classification;
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        document.getElementById('csvFileInput').addEventListener('change', function(e) {
            const files = e.target.files;
            if (files.length > 0) {
                Array.from(files).forEach(file => {
                    parseCSV(file);
                });
            }
        });

        function parseCSV(file) {
            Papa.parse(file, {
                encoding: 'Shift_JIS',
                complete: function(results) {
                    const data = results.data;
                    if (data.length === 0) return;

                    // 1è¡Œç›®ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã§ç¨®åˆ¥ã‚’åˆ¤å®š
                    const firstCell = (data[0][0] || '').trim();
                    
                    if (firstCell === 'æŠ•è³‡ä¿¡è¨—ç¨®åˆ¥') {
                        console.log('âœ… æŠ•è³‡ä¿¡è¨—CSVã¨åˆ¤å®š');
                        processFundData(data);
                    } else {
                        console.log('âœ… æ ªå¼CSVã¨åˆ¤å®š');
                        processData(data);
                    }
                }
            });
        }

        function processFundData(data) {
            if (data.length < 2) {
                console.log('æŠ•è³‡ä¿¡è¨—ãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™');
                return;
            }

            // åˆ—ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‹ã‚‰ç¢ºèªæ¸ˆã¿ï¼‰
            // [0]=æŠ•è³‡ä¿¡è¨—ç¨®åˆ¥, [1]=å£åº§åŒºåˆ†, [2]=ãƒ•ã‚¡ãƒ³ãƒ‰å, [3]=åˆ†é…é‡‘ã‚³ãƒ¼ã‚¹
            // [4]=ä¿æœ‰æ•°é‡, [7]=å¹³å‡å–å¾—ä¾¡é¡, [8]=å–å¾—ç·é¡, [9]=åŸºæº–ä¾¡é¡
            // [12]=æ™‚ä¾¡è©•ä¾¡é¡, [13]=è©•ä¾¡æç›Š, [14]=è©•ä¾¡æç›Š%

            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                if (!row || row.length < 15) continue;
                if (row[0] !== 'æŠ•è³‡ä¿¡è¨—') continue;
                if (!row[2] || row[2] === '') continue;

                const accountType = (row[1] || '').trim();
                const fundName = (row[2] || '').trim();
                const quantity = parseFloat((row[4] || '0').replace(/,/g, ''));
                const avgPrice = parseFloat((row[7] || '0').replace(/,/g, ''));
                const acquiredTotal = parseFloat((row[8] || '0').replace(/,/g, ''));
                const basePrice = parseFloat((row[9] || '0').replace(/,/g, ''));
                const marketValue = parseFloat((row[12] || '0').replace(/,/g, ''));
                const profitLoss = parseFloat((row[13] || '0').replace(/,/g, ''));
                const profitRate = parseFloat((row[14] || '0').replace(/,/g, ''));

                if (isNaN(marketValue) || marketValue === 0) continue;

                let accountClass = 'account-tokutei';
                let accountLabel = 'ç‰¹å®š';

                if (accountType.includes('NISAã¤ã¿ãŸã¦') || accountType.includes('ã¤ã¿ãŸã¦æŠ•è³‡æ ')) {
                    accountClass = 'account-nisa-tsumitate';
                    accountLabel = 'ã¤ã¿ãŸã¦NISA';
                } else if (accountType.includes('NISAæˆé•·') || accountType.includes('æˆé•·æŠ•è³‡æ ')) {
                    accountClass = 'account-nisa-growth';
                    accountLabel = 'æˆé•·æŠ•è³‡æ ';
                } else if (accountType.includes('iDeCo') || accountType.includes('ã‚¤ãƒ‡ã‚³') || accountType.includes('ç¢ºå®šæ‹ å‡º')) {
                    accountClass = 'account-ideco';
                    accountLabel = 'iDeCo';
                }

                const exists = fundsData.some(f => f.fundName === fundName && f.accountType === accountType);
                if (!exists) {
                    fundsData.push({
                        fundName, accountType, accountClass, accountLabel,
                        quantity, avgPrice, acquiredTotal, basePrice,
                        marketValue, profitLoss, profitRate
                    });
                }
            }

            console.log('âœ… æŠ•è³‡ä¿¡è¨—ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:', fundsData.length, 'æœ¬');
            updateDashboard();
        }

        function processData(data) {
            let startIndex = -1;
            
            // ä¿æœ‰å•†å“è©³ç´°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¢ã™
            for (let i = 0; i < data.length; i++) {
                if (data[i][0] === 'ç¨®åˆ¥' && data[i][1] === 'éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰ãƒ»ãƒ†ã‚£ãƒƒã‚«ãƒ¼') {
                    startIndex = i + 1;
                    break;
                }
            }

            if (startIndex === -1) {
                console.log('æ ªå¼ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                return;
            }

            // æ ªå¼ãƒ»æŠ•è³‡ä¿¡è¨—ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†
            // åˆ—æ§‹é€ ï¼ˆæ¥½å¤©è¨¼åˆ¸ assetbalance_all CSVï¼‰:
            // [0]=ç¨®åˆ¥, [1]=éŠ˜æŸ„ã‚³ãƒ¼ãƒ‰(æ ªå¼)/ç©º(æŠ•è³‡ä¿¡è¨—), [2]=éŠ˜æŸ„å/ãƒ•ã‚¡ãƒ³ãƒ‰å
            // [3]=å£åº§, [4]=ä¿æœ‰æ•°é‡, [5]=å˜ä½
            // [6]=å¹³å‡å–å¾—ä¾¡é¡, [7]=é€šè²¨, [8]=ç¾åœ¨ä¾¡æ ¼/åŸºæº–ä¾¡é¡, [9]=é€šè²¨
            // [10],[11]=ç©º, [12]=å‰æ—¥æ¯”, [13]=é€šè²¨
            // [14]=æ™‚ä¾¡è©•ä¾¡é¡[å††], [15]=å¤–è²¨å»ºã¦è©•ä¾¡é¡
            // [16]=è©•ä¾¡æç›Š[å††], [17]=è©•ä¾¡æç›Š[%]

            for (let i = startIndex; i < data.length; i++) {
                const row = data[i];
                if (!row || row.length < 15) continue;
                const type = (row[0] || '').trim();

                // ---- å›½å†…æ ªå¼ãƒ»ç±³å›½æ ªå¼ ----
                if ((type === 'å›½å†…æ ªå¼' || type === 'ç±³å›½æ ªå¼') && row[1] && row[4]) {
                    const code = row[1].trim();
                    const name = row[2].trim();
                    const quantity  = parseFloat((row[4] || '').replace(/,/g, ''));
                    const avgPrice  = parseFloat((row[6] || '').replace(/,/g, ''));
                    const currentPrice = parseFloat((row[8] || '').replace(/,/g, ''));
                    const marketValue  = parseFloat((row[14] || '').replace(/,/g, ''));
                    const profitLoss   = parseFloat((row[16] || '').replace(/[+,]/g, ''));
                    const profitRate   = parseFloat((row[17] || '').replace(/[+,]/g, ''));

                    if (!isNaN(quantity) && !isNaN(currentPrice) && !isNaN(marketValue)) {
                        const industryInfo = industryDatabase[code] || { name: 'ãã®ä»–', dividend: 3.0, months: [3, 9] };
                        const estimatedDividend = marketValue * (industryInfo.dividend / 100);
                        const priceChange = avgPrice > 0 ? ((currentPrice - avgPrice) / avgPrice) * 100 : 0;

                        let recommendation = 'HOLD';
                        if (priceChange <= -15) recommendation = 'STRONG_BUY';
                        else if (priceChange <= -10) recommendation = 'BUY';

                        const stockData = {
                            code, name, quantity, avgPrice, currentPrice,
                            marketValue, profitLoss, profitRate,
                            estimatedDividend, recommendation,
                            priceChange, industry: industryInfo.name, type
                        };

                        if (type === 'å›½å†…æ ªå¼') {
                            if (!domesticStocksData.some(s => s.code === code && s.name === name)) {
                                domesticStocksData.push(stockData);
                            }
                        } else {
                            if (!foreignStocksData.some(s => s.code === code && s.name === name)) {
                                foreignStocksData.push(stockData);
                            }
                        }
                    }
                }

                // ---- æŠ•è³‡ä¿¡è¨—ï¼ˆåŒä¸€CSVå†…ã«æ··åœ¨ï¼‰----
                // ã‚µãƒãƒªãƒ¼è¡Œã¯ row[1] ã«æ•°å€¤ãŒå…¥ã‚‹ â†’ row[1]==='' ã®è¡ŒãŒè©³ç´°è¡Œ
                else if (type === 'æŠ•è³‡ä¿¡è¨—' && row[1] === '' && row[2] && row[2].trim() !== '') {
                    const fundName     = row[2].trim();
                    const accountType  = (row[3] || '').trim();
                    const quantity     = parseFloat((row[4]  || '').replace(/,/g, ''));
                    const avgPrice     = parseFloat((row[6]  || '').replace(/,/g, ''));
                    const basePrice    = parseFloat((row[8]  || '').replace(/,/g, ''));
                    const marketValue  = parseFloat((row[14] || '').replace(/,/g, ''));
                    const profitLoss   = parseFloat((row[16] || '').replace(/[+,]/g, ''));
                    const profitRate   = parseFloat((row[17] || '').replace(/[+,]/g, ''));

                    // å–å¾—ç·é¡ = å¹³å‡å–å¾—ä¾¡é¡ Ã— å£æ•° / 10000ï¼ˆæŠ•è³‡ä¿¡è¨—ã¯1ä¸‡å£å˜ä½ï¼‰
                    const acquiredTotal = (!isNaN(avgPrice) && !isNaN(quantity)) ? Math.round(avgPrice * quantity / 10000) : 0;

                    if (!isNaN(marketValue) && marketValue > 0) {
                        let accountClass = 'account-tokutei';
                        let accountLabel = 'ç‰¹å®š';
                        if (accountType.includes('ã¤ã¿ãŸã¦æŠ•è³‡æ ') || accountType.includes('NISAã¤ã¿ãŸã¦')) {
                            accountClass = 'account-nisa-tsumitate';
                            accountLabel = 'ã¤ã¿ãŸã¦NISA';
                        } else if (accountType.includes('æˆé•·æŠ•è³‡æ ') || accountType.includes('NISAæˆé•·')) {
                            accountClass = 'account-nisa-growth';
                            accountLabel = 'æˆé•·æŠ•è³‡æ ';
                        } else if (accountType.includes('iDeCo') || accountType.includes('ã‚¤ãƒ‡ã‚³') || accountType.includes('ç¢ºå®šæ‹ å‡º')) {
                            accountClass = 'account-ideco';
                            accountLabel = 'iDeCo';
                        }

                        if (!fundsData.some(f => f.fundName === fundName && f.accountType === accountType)) {
                            fundsData.push({
                                fundName, accountType, accountClass, accountLabel,
                                quantity, avgPrice, acquiredTotal, basePrice,
                                marketValue, profitLoss, profitRate
                            });
                            console.log(`  æŠ•è³‡ä¿¡è¨—è¿½åŠ : ${fundName} (${accountLabel}) Â¥${marketValue.toLocaleString()}`);
                        }
                    }
                }
            }

            console.log('âœ… å›½å†…æ ªå¼:', domesticStocksData.length, 'éŠ˜æŸ„');
            console.log('âœ… å¤–å›½æ ªå¼:', foreignStocksData.length, 'éŠ˜æŸ„');
            console.log('âœ… æŠ•è³‡ä¿¡è¨—:', fundsData.length, 'æœ¬');

            allStocksData = [...domesticStocksData, ...foreignStocksData];
            updateDashboard();
        }

        function updateDashboard() {
            const totalStocks = domesticStocksData.length + foreignStocksData.length + fundsData.length;
            if (totalStocks === 0) {
                return;
            }

            document.getElementById('noData').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';

            // å›½å†…æ ªå¼ã®åˆè¨ˆ
            const domesticTotalValue = domesticStocksData.reduce((sum, s) => sum + s.marketValue, 0);
            const domesticTotalCost = domesticStocksData.reduce((sum, s) => sum + (s.avgPrice * s.quantity), 0);
            const domesticTotalDividend = domesticStocksData.reduce((sum, s) => sum + s.estimatedDividend, 0);

            // å¤–å›½æ ªå¼ã®åˆè¨ˆ
            const foreignTotalValue = foreignStocksData.reduce((sum, s) => sum + s.marketValue, 0);
            const foreignTotalCost = foreignStocksData.reduce((sum, s) => sum + (s.avgPrice * s.quantity), 0);

            // æŠ•è³‡ä¿¡è¨—ã®åˆè¨ˆ
            const fundsTotalValue = fundsData.reduce((sum, f) => sum + f.marketValue, 0);
            const fundsTotalCost = fundsData.reduce((sum, f) => sum + f.acquiredTotal, 0);

            // ç·åˆè¨ˆ
            const totalValue = domesticTotalValue + foreignTotalValue + fundsTotalValue;
            const totalCost = domesticTotalCost + foreignTotalCost + fundsTotalCost;
            const totalProfit = totalValue - totalCost;
            const profitRate = totalCost > 0 ? (totalProfit / totalCost) * 100 : 0;
            const totalDividendBefore = domesticTotalDividend; // å›½å†…æ ªã®ã¿
            const totalDividendAfter = totalDividendBefore * (1 - TAX_RATE);

            document.getElementById('totalValue').textContent = formatCurrency(totalValue);
            document.getElementById('totalProfit').textContent = formatCurrency(totalProfit);
            document.getElementById('totalProfit').className = 'card-value ' + (totalProfit >= 0 ? 'positive' : 'negative');
            document.getElementById('profitRate').textContent = (profitRate >= 0 ? '+' : '') + profitRate.toFixed(2) + '%';
            document.getElementById('profitRate').className = 'card-value ' + (profitRate >= 0 ? 'positive' : 'negative');
            document.getElementById('annualDividendBefore').textContent = formatCurrency(totalDividendBefore);
            document.getElementById('annualDividendAfter').textContent = formatCurrency(totalDividendAfter);

            if (totalProfit < 0) {
                document.getElementById('profitSubtitle').textContent = 'è²·ã£ãŸæ™‚ã‚ˆã‚Šæ¸›ã£ãŸé‡‘é¡';
            }

            // ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæ¡ç‚¹
            const scoreResult = calculatePortfolioScore(domesticStocksData, foreignStocksData, fundsData, profitRate);
            document.getElementById('portfolioScore').innerHTML = `${scoreResult.score}<span class="score-grade">/${scoreResult.grade}</span>`;
            const scoreElement = document.getElementById('portfolioScore');
            if (scoreResult.score >= 80) {
                scoreElement.className = 'card-value score positive';
            } else if (scoreResult.score >= 60) {
                scoreElement.className = 'card-value score';
            } else {
                scoreElement.className = 'card-value score negative';
            }
            document.getElementById('scoreComment').textContent = scoreResult.comments.join(' / ');

            // å¸‚å ´åˆ†æã‚’ç”Ÿæˆ
            const analysisHTML = generateMarketAnalysis(profitRate, fearGreedIndex, domesticStocksData);
            document.getElementById('marketAnalysisContent').innerHTML = analysisHTML;

            const status = document.getElementById('uploadStatus');
            const parts = [];
            if (domesticStocksData.length > 0) parts.push(`å›½å†…æ ª${domesticStocksData.length}éŠ˜æŸ„`);
            if (foreignStocksData.length > 0) parts.push(`å¤–å›½æ ª${foreignStocksData.length}éŠ˜æŸ„`);
            if (fundsData.length > 0) parts.push(`æŠ•è³‡ä¿¡è¨—${fundsData.length}æœ¬`);
            status.innerHTML = `<div class="file-status">âœ“ ${parts.join(' / ')}</div>`;

            // ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º
            if (domesticStocksData.length > 0) {
                displayStockTable(domesticStocksData, 'domesticTableBody');
                createIndustrySummary(domesticStocksData);
                createIndustryChart(domesticStocksData);
                createDomesticPerformanceChart(domesticStocksData);
                createMonthlyDividend(domesticStocksData);
            }
            if (foreignStocksData.length > 0) {
                displayStockTable(foreignStocksData, 'foreignTableBody');
                createForeignPerformanceChart(foreignStocksData);
            }
            if (fundsData.length > 0) {
                displayFundTable(fundsData);
            }

            // è³‡ç”£åˆ†é¡ãƒãƒ£ãƒ¼ãƒˆ
            createAssetTypeChart(domesticTotalValue, foreignTotalValue, fundsTotalValue);
        }

        function createIndustrySummary(stocks) {
            const industryCounts = {};
            stocks.forEach(stock => {
                industryCounts[stock.industry] = (industryCounts[stock.industry] || 0) + 1;
            });

            const grid = document.getElementById('industryGrid');
            grid.innerHTML = '';

            Object.entries(industryCounts)
                .sort((a, b) => b[1] - a[1])
                .forEach(([industry, count]) => {
                    const item = document.createElement('div');
                    item.className = 'industry-item';
                    item.onclick = () => showIndustryStocks(industry, stocks);
                    item.innerHTML = `
                        <div class="industry-item-name">${industry}</div>
                        <div class="industry-item-count">${count}</div>
                        <div class="industry-item-label">éŠ˜æŸ„</div>
                    `;
                    grid.appendChild(item);
                });
        }

        function showIndustryStocks(industry, allStocks) {
            const stocks = allStocks.filter(s => s.industry === industry);
            document.getElementById('modalIndustryName').textContent = `${industry}æ¥­ç•Œã®éŠ˜æŸ„`;
            
            const listContainer = document.getElementById('modalStockList');
            listContainer.innerHTML = '';

            stocks.sort((a, b) => b.marketValue - a.marketValue).forEach(stock => {
                const item = document.createElement('div');
                item.className = 'stock-list-item';
                item.innerHTML = `
                    <div class="stock-list-code">${stock.code}</div>
                    <div class="stock-list-name">${stock.name}</div>
                    <div class="stock-list-details">
                        <div class="stock-list-detail">
                            <div class="stock-list-label">ä¿æœ‰æ•°</div>
                            <div class="stock-list-value">${stock.quantity.toLocaleString()}æ ª</div>
                        </div>
                        <div class="stock-list-detail">
                            <div class="stock-list-label">ç¾åœ¨ä¾¡æ ¼</div>
                            <div class="stock-list-value">Â¥${stock.currentPrice.toLocaleString()}</div>
                        </div>
                        <div class="stock-list-detail">
                            <div class="stock-list-label">è©•ä¾¡é¡</div>
                            <div class="stock-list-value">Â¥${stock.marketValue.toLocaleString()}</div>
                        </div>
                        <div class="stock-list-detail">
                            <div class="stock-list-label">æç›Šç‡</div>
                            <div class="stock-list-value ${stock.profitRate >= 0 ? 'positive-value' : 'negative-value'}">
                                ${stock.profitRate >= 0 ? '+' : ''}${stock.profitRate.toFixed(2)}%
                            </div>
                        </div>
                    </div>
                `;
                listContainer.appendChild(item);
            });

            document.getElementById('industryModal').classList.add('active');
        }

        function closeIndustryModal() {
            document.getElementById('industryModal').classList.remove('active');
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('industryModal');
            if (event.target === modal) {
                closeIndustryModal();
            }
        });

        function displayStockTable(stocks, tbodyId) {
            const tbody = document.getElementById(tbodyId);
            tbody.innerHTML = '';
            
            const sorted = [...stocks].sort((a, b) => b.marketValue - a.marketValue);

            sorted.forEach(stock => {
                const tr = document.createElement('tr');
                
                let recommendationBadge = '';
                if (stock.recommendation === 'STRONG_BUY') {
                    recommendationBadge = '<span class="badge strong-buy">ğŸ”¥ ä»ŠãŒè²·ã„æ™‚ï¼</span>';
                } else if (stock.recommendation === 'BUY') {
                    recommendationBadge = '<span class="badge buy">ğŸ’¡ è²·ã„å¢—ã—æ¤œè¨</span>';
                } else {
                    recommendationBadge = '<span class="badge hold">âœ“ ä¿æŒ</span>';
                }

                const industryBadge = stock.industry ? `<span class="industry-badge industry-${stock.industry}">${stock.industry}</span>` : '';
                
                // AIåˆ†æã«ã‚ˆã‚‹æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ç†ç”±ã‚’ç”Ÿæˆ
                const advice = generateActionAdvice(stock);
                const actionClass = advice.action === '-' ? 'action-cell empty' : 'action-cell';

                tr.innerHTML = `
                    <td>
                        <div class="stock-code">${stock.code}</div>
                        <div class="stock-name">${stock.name}</div>
                    </td>
                    <td>${industryBadge}</td>
                    <td><strong>${stock.quantity.toLocaleString()}</strong>æ ª</td>
                    <td>Â¥${stock.avgPrice.toLocaleString()}</td>
                    <td><strong>Â¥${stock.currentPrice.toLocaleString()}</strong></td>
                    <td class="${stock.profitLoss >= 0 ? 'positive-value' : 'negative-value'}">
                        ${stock.profitLoss >= 0 ? '+' : ''}Â¥${stock.profitLoss.toLocaleString()}
                    </td>
                    <td class="${stock.profitRate >= 0 ? 'positive-value' : 'negative-value'}">
                        ${stock.profitRate >= 0 ? '+' : ''}${stock.profitRate.toFixed(2)}%
                    </td>
                    <td><strong>Â¥${stock.marketValue.toLocaleString()}</strong></td>
                    <td>${recommendationBadge}</td>
                    <td class="${actionClass}">${advice.action}</td>
                    <td class="reason-cell">${advice.reason}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function displayFundTable(funds) {
            const tbody = document.getElementById('fundsTableBody');
            tbody.innerHTML = '';
            
            const sorted = [...funds].sort((a, b) => b.marketValue - a.marketValue);

            sorted.forEach(fund => {
                const tr = document.createElement('tr');
                
                tr.innerHTML = `
                    <td>
                        <div style="font-weight: 600; color: var(--text-primary); max-width: 400px;">${fund.fundName}</div>
                    </td>
                    <td>
                        <span class="account-badge ${fund.accountClass}">${fund.accountLabel}</span>
                    </td>
                    <td><strong>${fund.quantity.toLocaleString()}</strong>å£</td>
                    <td>Â¥${fund.avgPrice.toLocaleString()}</td>
                    <td><strong>Â¥${fund.basePrice.toLocaleString()}</strong></td>
                    <td class="${fund.profitLoss >= 0 ? 'positive-value' : 'negative-value'}">
                        ${fund.profitLoss >= 0 ? '+' : ''}Â¥${fund.profitLoss.toLocaleString()}
                    </td>
                    <td class="${fund.profitRate >= 0 ? 'positive-value' : 'negative-value'}">
                        ${fund.profitRate >= 0 ? '+' : ''}${fund.profitRate.toFixed(2)}%
                    </td>
                    <td><strong>Â¥${fund.marketValue.toLocaleString()}</strong></td>
                `;
                tbody.appendChild(tr);
            });
        }

        function createIndustryChart(stocks) {
            const ctx = document.getElementById('industryChart').getContext('2d');
            if (industryChart) industryChart.destroy();

            const industryTotals = {};
            stocks.forEach(stock => {
                industryTotals[stock.industry] = (industryTotals[stock.industry] || 0) + stock.marketValue;
            });

            const sortedEntries = Object.entries(industryTotals).sort((a, b) => b[1] - a[1]);
            const labels = sortedEntries.map(e => e[0]);
            const values = sortedEntries.map(e => e[1]);

            industryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: [
                            '#10b981', '#34d399', '#6ee7b7', '#a7f3d0', 
                            '#d1fae5', '#6366f1', '#8b5cf6', '#ec4899',
                            '#f59e0b', '#ef4444'
                        ],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.label}: Â¥${value.toLocaleString()} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createAssetTypeChart(domesticValue, foreignValue, fundsValue) {
            const ctx = document.getElementById('assetTypeChart').getContext('2d');
            if (assetTypeChart) assetTypeChart.destroy();

            const labels = [];
            const values = [];
            const colors = [];

            if (domesticValue > 0) {
                labels.push('å›½å†…æ ªå¼');
                values.push(domesticValue);
                colors.push('#10b981');
            }
            if (foreignValue > 0) {
                labels.push('å¤–å›½æ ªå¼');
                values.push(foreignValue);
                colors.push('#6366f1');
            }
            if (fundsValue > 0) {
                labels.push('æŠ•è³‡ä¿¡è¨—');
                values.push(fundsValue);
                colors.push('#ec4899');
            }

            assetTypeChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: colors,
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: { size: 12 }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.label}: Â¥${value.toLocaleString()} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function createDomesticPerformanceChart(stocks) {
            const ctx = document.getElementById('domesticPerformanceChart').getContext('2d');
            if (domesticPerformanceChart) domesticPerformanceChart.destroy();

            if (stocks.length === 0) {
                ctx.font = '16px Outfit';
                ctx.fillStyle = '#9ca3af';
                ctx.textAlign = 'center';
                ctx.fillText('ãƒ‡ãƒ¼ã‚¿ãªã—', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }

            const sorted = [...stocks].sort((a, b) => b.profitRate - a.profitRate);
            const labels = sorted.map(s => s.name.length > 15 ? s.name.substring(0, 15) + '...' : s.name);
            const values = sorted.map(s => s.profitRate);
            const colors = values.map(v => v >= 0 ? '#10b981' : '#ef4444');

            domesticPerformanceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'æç›Šç‡ (%)',
                        data: values,
                        backgroundColor: colors,
                        borderRadius: 8
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `æç›Šç‡: ${context.parsed.x >= 0 ? '+' : ''}${context.parsed.x.toFixed(2)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        y: {
                            ticks: {
                                font: { size: 11 }
                            }
                        }
                    }
                }
            });
        }

        function createForeignPerformanceChart(stocks) {
            const ctx = document.getElementById('foreignPerformanceChart').getContext('2d');
            if (foreignPerformanceChart) foreignPerformanceChart.destroy();

            if (stocks.length === 0) {
                ctx.font = '16px Outfit';
                ctx.fillStyle = '#9ca3af';
                ctx.textAlign = 'center';
                ctx.fillText('ãƒ‡ãƒ¼ã‚¿ãªã—', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }

            const sorted = [...stocks].sort((a, b) => b.profitRate - a.profitRate);
            const labels = sorted.map(s => s.name.length > 15 ? s.name.substring(0, 15) + '...' : s.name);
            const values = sorted.map(s => s.profitRate);
            const colors = values.map(v => v >= 0 ? '#6366f1' : '#ef4444');

            foreignPerformanceChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'æç›Šç‡ (%)',
                        data: values,
                        backgroundColor: colors,
                        borderRadius: 8
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `æç›Šç‡: ${context.parsed.x >= 0 ? '+' : ''}${context.parsed.x.toFixed(2)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        },
                        y: {
                            ticks: {
                                font: { size: 11 }
                            }
                        }
                    }
                }
            });
        }

        function createMonthlyDividend(stocks) {
            const MONTH_NAMES = ['1æœˆ','2æœˆ','3æœˆ','4æœˆ','5æœˆ','6æœˆ','7æœˆ','8æœˆ','9æœˆ','10æœˆ','11æœˆ','12æœˆ'];
            const MONTH_EN    = ['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'];
            const currentMonth = new Date().getMonth(); // 0-indexed

            // --- æœˆåˆ¥é›†è¨ˆï¼ˆéŠ˜æŸ„ãƒªã‚¹ãƒˆä»˜ãï¼‰---
            const monthlyDividends = new Array(12).fill(0);
            const monthlyStocks    = Array.from({length:12}, ()=>[]);

            stocks.forEach(stock => {
                const info = industryDatabase[stock.code];
                if (info && info.months && info.months.length > 0) {
                    const perTime = stock.estimatedDividend / info.months.length;
                    info.months.forEach(m => {
                        monthlyDividends[m-1] += perTime;
                        monthlyStocks[m-1].push({
                            name: stock.name,
                            amount: Math.round(perTime)
                        });
                    });
                } else {
                    // æœªç™»éŒ²éŠ˜æŸ„ï¼š3æœˆãƒ»9æœˆã®å¹´2å›ã¨ä»®å®š
                    const perTime = stock.estimatedDividend / 2;
                    [2, 8].forEach(idx => {
                        monthlyDividends[idx] += perTime;
                        monthlyStocks[idx].push({ name: stock.name, amount: Math.round(perTime) });
                    });
                }
            });

            const totalBefore = monthlyDividends.reduce((s,v)=>s+v, 0);
            const totalAfter  = totalBefore * (1 - TAX_RATE);

            // --- ãƒãƒŠãƒ¼æ›´æ–° ---
            const bannerBefore = document.getElementById('divTotalBefore');
            const bannerAfter  = document.getElementById('divTotalAfter');
            if (bannerBefore) bannerBefore.textContent = 'Â¥' + Math.round(totalBefore).toLocaleString();
            if (bannerAfter)  bannerAfter.textContent  = 'Â¥' + Math.round(totalAfter).toLocaleString();

            // --- æœˆã‚°ãƒªãƒƒãƒ‰ç”Ÿæˆ ---
            const container = document.getElementById('monthlyDividend');
            container.innerHTML = '';

            MONTH_NAMES.forEach((mName, idx) => {
                const before  = monthlyDividends[idx];
                const after   = before * (1 - TAX_RATE);
                const hasDiv  = before > 0;
                const isCurrent = idx === currentMonth;

                const card = document.createElement('div');
                card.className = 'month-card ' + (hasDiv ? 'has-dividend' : 'no-dividend') + (isCurrent ? ' current-month' : '');

                if (hasDiv) {
                    // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ç”¨éŠ˜æŸ„ãƒªã‚¹ãƒˆ
                    const topStocks = monthlyStocks[idx]
                        .sort((a,b) => b.amount - a.amount)
                        .slice(0, 5)
                        .map(s => `${s.name.substring(0,10)} Â¥${s.amount.toLocaleString()}`)
                        .join('\n');

                    card.innerHTML = `
                        <div class="mc-month">${MONTH_EN[idx]} / ${mName}</div>
                        <div class="mc-main-amount">Â¥${Math.round(before).toLocaleString()}</div>
                        <div class="mc-main-label">ç¨å¼•å‰ï¼ˆæ¨å®šï¼‰</div>
                        <hr class="mc-divider">
                        <div class="mc-after-amount">Â¥${Math.round(after).toLocaleString()}</div>
                        <div class="mc-after-label">ğŸ‘› å®Ÿéš›ã«å—ã‘å–ã‚‹é¡</div>
                        <div class="mc-stocks-tooltip" style="white-space:pre">${topStocks}</div>
                    `;
                } else {
                    card.innerHTML = `
                        <div class="mc-month">${MONTH_EN[idx]} / ${mName}</div>
                        <div class="mc-no-div-text">é…å½“ãªã—</div>
                    `;
                }

                container.appendChild(card);
            });
        }

        function formatCurrency(value) {
            return 'Â¥' + Math.round(value).toLocaleString();
        }

        fetchFearGreedIndex();
    </script>
</body>
</html>
